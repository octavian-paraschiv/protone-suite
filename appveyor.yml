version: 3.1.{build}
skip_tags: true
image: Visual Studio 2017

before_build:
- echo "Restoring NuGet packages from ProTONE Suite solution ..."
- nuget restore ".\ProTONE Suite\src\ProTONE Suite.sln" -Verbosity Quiet

build_script:
- echo "Building ProTONE Suite solution ..."
- msbuild /restore /p:Configuration=Debug /t:Rebuild ".\ProTONE Suite\src\ProTONE Suite.sln" /v:minimal 
  
after_build:
- echo "Copying Romanian language file for Inno Setup"
- copy ".\ProTONE Suite\src\Installers\Romanian.isl" "C:\Program Files (x86)\Inno Setup 5\Languages"
- echo "Building ProTONE Suite installer ..."
- set PATH=%PATH%;"C:\Program Files (x86)\Inno Setup 5"
- ISCC /Q ".\ProTONE Suite\src\Installers\ProtoneSuite.iss"
- ".\ProTONE Suite\create_buildinfo.bat" %APPVEYOR_BUILD_VERSION%
- copy ".\ProTONE Suite\*.txt" ".\ProTONE Suite\output"
- dir ".\ProTONE Suite\output"
- 7z a protone-setup.zip ".\ProTONE Suite\output\*.*"

artifacts:
- path: protone-setup.zip
  name: protone-setup

deploy:
    provider: FTP
    protocol: ftp
    host: 188.213.19.151
    username: ocparo
    password:
        secure: WLrEKSe6D0A7YU3E96co+w==
    folder: httpdocs/ProTONE/current/
    application: protone-setup

    


